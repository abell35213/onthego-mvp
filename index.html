<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>OnTheGo - Find Restaurants Nearby</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/styles.css" />
</head>

<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <h1><i class="fas fa-utensils"></i> OnTheGo</h1>
      <p class="tagline">Client-ready dining near your hotel</p>
    </div>

    <div class="header-actions">
      <button id="shareBtn" class="view-toggle-btn" title="Share my shortlist">
        <i class="fas fa-share-nodes"></i>
        <span>Share</span>
      </button>

      <button id="viewToggle" class="view-toggle-btn" title="Switch View">
        <i class="fas fa-list"></i>
        <span>Restaurant List</span>
      </button>

      <button id="travelLogBtn" class="view-toggle-btn" title="My Travel Log">
        <i class="fas fa-book"></i>
        <span>My Travel Log</span>
      </button>

      <button id="accountBtn" class="account-btn" title="Account Settings">
        <i class="fas fa-user-circle"></i>
      </button>
    </div>
  </header>

  <!-- Account Modal -->
  <div id="accountModal" class="modal" style="display:none;">
    <div class="modal-content">
      <span class="close">&times;</span>

      <div class="account-tabs">
        <button class="account-tab active" data-tab="profile"><i class="fas fa-user"></i> Profile</button>
        <button class="account-tab" data-tab="connections"><i class="fas fa-link"></i> Connections</button>
        <button class="account-tab" data-tab="settings"><i class="fas fa-cog"></i> Settings</button>
      </div>

      <div id="profileTab" class="tab-content active">
        <h2><i class="fas fa-user-circle"></i> Your Profile</h2>
        <p class="modal-description">Create your account or update your profile information.</p>

        <form id="accountForm" class="account-form">
          <div class="form-group">
            <label for="userName"><i class="fas fa-user"></i> Full Name *</label>
            <input type="text" id="userName" class="form-input" placeholder="Enter your full name" required />
          </div>

          <div class="form-group">
            <label for="userEmail"><i class="fas fa-envelope"></i> Email Address *</label>
            <input type="email" id="userEmail" class="form-input" placeholder="you@example.com" required />
          </div>

          <div class="form-group">
            <label for="userPhone"><i class="fas fa-phone"></i> Phone Number * <small>(for text alerts)</small></label>
            <input type="tel" id="userPhone" class="form-input" placeholder="(555) 123-4567" required />
          </div>

          <button type="submit" id="saveProfileBtn" class="save-profile-btn">
            <i class="fas fa-save"></i> Save Profile
          </button>

          <div id="profileSavedMsg" class="profile-saved-msg" style="display:none;">
            <i class="fas fa-check-circle"></i> Profile saved successfully!
          </div>
        </form>
      </div>

      <div id="connectionsTab" class="tab-content" style="display:none;">
        <h2><i class="fas fa-link"></i> Connect Your Accounts</h2>
        <p class="modal-description">Demo connections (front-end only). Toggle to simulate linking.</p>

        <div class="account-connections">
          <div class="account-card" data-account-type="concur">
            <div class="account-header"><i class="fas fa-briefcase account-icon"></i><h3>Concur</h3></div>
            <p>Sync your business travel expenses and itineraries</p>
            <button class="connect-btn" data-connect="concur"><i class="fas fa-plug"></i><span class="connect-text">Connect</span></button>
            <div class="connection-status" data-status="concur" style="display:none;">
              <i class="fas fa-check-circle"></i> Connected
              <button class="disconnect-btn" data-disconnect="concur">Disconnect</button>
            </div>
          </div>

          <div class="account-card" data-account-type="tripit">
            <div class="account-header"><i class="fas fa-plane account-icon"></i><h3>TripIt</h3></div>
            <p>Import your travel plans and reservations</p>
            <button class="connect-btn" data-connect="tripit"><i class="fas fa-plug"></i><span class="connect-text">Connect</span></button>
            <div class="connection-status" data-status="tripit" style="display:none;">
              <i class="fas fa-check-circle"></i> Connected
              <button class="disconnect-btn" data-disconnect="tripit">Disconnect</button>
            </div>
          </div>

          <div class="account-card" data-account-type="marriott">
            <div class="account-header"><i class="fas fa-crown account-icon"></i><h3>Marriott Bonvoy</h3></div>
            <p>Sync your Marriott stays and rewards</p>
            <button class="connect-btn" data-connect="marriott"><i class="fas fa-plug"></i><span class="connect-text">Connect</span></button>
            <div class="connection-status" data-status="marriott" style="display:none;">
              <i class="fas fa-check-circle"></i> Connected
              <button class="disconnect-btn" data-disconnect="marriott">Disconnect</button>
            </div>
          </div>

          <div class="account-card" data-account-type="hilton">
            <div class="account-header"><i class="fas fa-star account-icon"></i><h3>Hilton Honors</h3></div>
            <p>Sync your Hilton stays and rewards</p>
            <button class="connect-btn" data-connect="hilton"><i class="fas fa-plug"></i><span class="connect-text">Connect</span></button>
            <div class="connection-status" data-status="hilton" style="display:none;">
              <i class="fas fa-check-circle"></i> Connected
              <button class="disconnect-btn" data-disconnect="hilton">Disconnect</button>
            </div>
          </div>
        </div>

        <div id="syncInfo" class="sync-info" style="display:none;">
          <i class="fas fa-sync-alt"></i>
          <span id="lastSyncTime">Last synced: Never</span>
        </div>
      </div>

      <div id="settingsTab" class="tab-content" style="display:none;">
        <h2><i class="fas fa-cog"></i> Settings</h2>
        <p class="modal-description">Customize your OnTheGo experience.</p>

        <div class="settings-section">
          <h3><i class="fas fa-bell"></i> Notifications</h3>
          <div class="settings-group">
            <label class="settings-toggle"><input type="checkbox" id="settingTextAlerts" checked /> <span class="toggle-label">Text alerts</span></label>
            <label class="settings-toggle"><input type="checkbox" id="settingEmailAlerts" checked /> <span class="toggle-label">Email notifications</span></label>
            <label class="settings-toggle"><input type="checkbox" id="settingDealAlerts" /> <span class="toggle-label">Deal alerts near hotel</span></label>
          </div>
        </div>

        <div class="settings-section">
          <h3><i class="fas fa-map-marker-alt"></i> Map Preferences</h3>
          <div class="settings-group">
            <div class="form-group">
              <label for="settingRadius">Search Radius</label>
              <select id="settingRadius" class="form-input">
                <option value="1609">1 mile</option>
                <option value="4828">3 miles</option>
                <option value="8047" selected>5 miles</option>
                <option value="16093">10 miles</option>
              </select>
            </div>
          </div>
        </div>

        <div class="settings-section">
          <h3><i class="fas fa-database"></i> Data Provider</h3>
          <div class="settings-group">
            <div class="form-group">
              <label for="settingProvider">Restaurant Source</label>
              <select id="settingProvider" class="form-input">
                <option value="google" selected>Google Places (recommended)</option>
                <option value="mock">Demo Data (offline)</option>
              </select>
              <small class="muted">Google Places + Routes use the included proxy server.</small>
            </div>
          </div>
        </div>

        <button id="saveSettingsBtn" class="save-profile-btn"><i class="fas fa-save"></i> Save Settings</button>
        <div id="settingsSavedMsg" class="profile-saved-msg" style="display:none;">
          <i class="fas fa-check-circle"></i> Settings saved successfully!
        </div>
      </div>
    </div>
  </div>

  <!-- Notes Modal -->
  <div id="noteModal" class="modal" style="display:none;">
    <div class="modal-content note-modal">
      <span class="close" id="noteModalClose">&times;</span>
      <h2><i class="fas fa-note-sticky"></i> Notes</h2>
      <p id="noteModalSubtitle" class="modal-description"></p>

      <textarea id="noteTextarea" class="form-input note-textarea" rows="7"
                placeholder="Add quick notes (e.g., 'Quiet booth near back, great for client dinner')"></textarea>

      <div class="note-actions">
        <button id="saveNoteBtn" class="save-profile-btn"><i class="fas fa-save"></i> Save Note</button>
        <button id="toggleShortlistBtn" class="btn-tertiary" type="button">
          <i class="fas fa-star"></i> Add to Shortlist
        </button>
        <button id="calendarBtn" class="btn-secondary" type="button">
          <i class="fas fa-calendar-plus"></i> Add to Calendar
        </button>
      </div>

      <div id="noteSavedMsg" class="profile-saved-msg" style="display:none;">
        <i class="fas fa-check-circle"></i> Note saved!
      </div>
    </div>
  </div>

  <!-- Main Container -->
  <main class="container" id="mainContainer">
    <!-- World View (Landing) -->
    <div id="worldView" class="world-view">
      <div class="world-map-wrap">
        <div id="worldMap" class="world-map"></div>

        <div class="hero-overlay">
          <div class="hero-card">
            <div class="hero-kicker">OnTheGo for Sales Travel</div>
            <h2 class="hero-title">Find the best restaurants around your hotel</h2>
            <p class="hero-subtitle">Open-now, reservable, client-friendly — plus walk/drive times.</p>

            <form id="hotelSearchForm" class="hero-form" autocomplete="off">
              <div class="hero-search">
                <i class="fas fa-hotel"></i>
                <input id="hotelSearchInput" type="text"
                       placeholder="Type your hotel or address (e.g., 'Hyatt Austin' or '233 S Wacker Chicago')" />
                <button class="hero-btn" type="submit"><i class="fas fa-magnifying-glass"></i> Search</button>
              </div>
              <div id="hotelSuggestions" class="suggestions" style="display:none;"></div>
            </form>

            <div class="hero-actions">
              <button id="heroUseGps" class="btn-secondary" type="button">
                <i class="fas fa-location-crosshairs"></i> Use my location
              </button>
              <button id="heroUseSavedTrips" class="btn-tertiary" type="button">
                <i class="fas fa-history"></i> Pick a saved trip
              </button>
            </div>

            <div class="hero-meta">
              <span id="providerBadge" class="provider-badge"><i class="fas fa-database"></i> Google Places</span>
              <span class="privacy-note"><i class="fas fa-shield"></i> Location only used when you click.</span>
            </div>
          </div>
        </div>
      </div>

      <aside class="trip-sidebar">
        <h2><i class="fas fa-history"></i> Travel History</h2>
        <div id="tripHistory" class="trip-history-list"></div>

        <h2 style="margin-top:2rem;"><i class="fas fa-calendar-alt"></i> Upcoming Trips</h2>
        <div id="upcomingTrips" class="upcoming-trips-list"></div>
      </aside>
    </div>

    <!-- Local View -->
    <div id="localView" class="local-view" style="display:none;">
      <aside class="sidebar" id="searchSidebar">
        <div class="sidebar-resize-handle" id="sidebarResizeHandle"></div>

        <button class="sidebar-toggle-btn" id="sidebarToggleBtn" title="Toggle search panel">
          <i class="fas fa-chevron-left"></i>
        </button>

        <div class="location-controls">
          <label for="tripLocationSelect" class="location-label">Search near:</label>
          <select id="tripLocationSelect" class="filter-select location-select">
            <option value="" disabled selected>Select a trip…</option>
          </select>

          <button id="useGpsBtn" class="location-btn">
            <i class="fas fa-location-crosshairs"></i> Use My Location
          </button>

          <div id="activeLocationLabel" class="active-location"></div>
          <div id="timeHint" class="time-hint" style="display:none;"></div>

          <div class="quick-chips" id="quickChips">
            <button type="button" class="chip active" data-preset="client_dinner"><i class="fas fa-briefcase"></i> Client Dinner</button>
            <button type="button" class="chip" data-preset="quick_lunch"><i class="fas fa-bolt"></i> Quick Lunch</button>
            <button type="button" class="chip" data-preset="coffee"><i class="fas fa-mug-hot"></i> Coffee</button>
            <button type="button" class="chip" data-preset="drinks"><i class="fas fa-martini-glass-citrus"></i> Drinks</button>
          </div>
        </div>

        <div class="search-container">
          <input type="text" id="searchInput" class="search-input"
                 placeholder="Search by name, cuisine, city, state, or zip..." />
          <i class="fas fa-search search-icon"></i>
        </div>

        <div class="filters">
          <div class="filter-group">
            <label for="cuisineFilter">Cuisine:</label>
            <select id="cuisineFilter" class="filter-select">
              <option value="">All Cuisines</option>
            </select>
          </div>

          <div class="filter-group">
            <label for="priceFilter">Price:</label>
            <select id="priceFilter" class="filter-select">
              <option value="">All Prices</option>
              <option value="$">$ - Budget</option>
              <option value="$$">$$ - Moderate</option>
              <option value="$$$">$$$ - Expensive</option>
              <option value="$$$$">$$$$ - Very Expensive</option>
            </select>
          </div>

          <div class="filter-group">
            <label for="ambianceFilter">Ambiance:</label>
            <select id="ambianceFilter" class="filter-select">
              <option value="">All Types</option>
              <option value="Good for Business Meal">Business Meal</option>
              <option value="Chill">Chill</option>
              <option value="Fun">Fun</option>
              <option value="Local Spots">Local Spots</option>
            </select>
          </div>

          <div class="filter-group">
            <label for="sortBy">Sort By:</label>
            <select id="sortBy" class="filter-select">
              <option value="client_score">Client Dinner Score</option>
              <option value="rating">Rating</option>
              <option value="distance">Distance</option>
              <option value="review_count">Reviews</option>
            </select>
          </div>

          <div class="filter-group">
            <label><input type="checkbox" id="openNowFilter" class="filter-checkbox" /> Open now</label>
          </div>

          <div class="filter-group">
            <label><input type="checkbox" id="visitedFilter" class="filter-checkbox" /> Show Only Visited</label>
          </div>
        </div>

        <div id="restaurantList" class="restaurant-list">
          <div id="shortlistBar" class="shortlist-bar" style="display:none;">
            <div class="shortlist-left">
              <i class="fas fa-star"></i>
              <span id="shortlistCount">0</span>
              <span class="muted">in shortlist</span>
            </div>
            <div class="shortlist-right">
              <button id="shortlistShareBtn" class="mini-btn" type="button"><i class="fas fa-share-nodes"></i> Share</button>
              <button id="shortlistClearBtn" class="mini-btn danger" type="button"><i class="fas fa-trash"></i></button>
            </div>
          </div>

          <div id="loadingState" class="loading-state">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Finding restaurants near you...</p>
          </div>

          <div id="emptyState" class="empty-state" style="display:none;">
            <i class="fas fa-search"></i>
            <p>No restaurants found</p>
            <small>Try adjusting your filters</small>
          </div>
        </div>
      </aside>

      <div class="map-container">
        <div id="map"></div>
      </div>

      <div id="conciergeDrawer" class="concierge-drawer" aria-hidden="true">
        <button id="conciergeDrawerHandle" class="concierge-drawer-handle" type="button" aria-controls="searchSidebar" aria-expanded="false">
          <i class="fas fa-concierge-bell"></i>
          <span>Concierge</span>
        </button>
      </div>
    </div>

    <!-- Travel Log -->
    <div id="travelLogView" class="travel-log-view" style="display:none;">
      <div class="travel-log-header">
        <h2><i class="fas fa-book"></i> My Travel Log</h2>
        <p>Shortlists, notes, and visited places — year by year.</p>
      </div>
      <div class="travel-log-stats" id="travelLogStats"></div>
      <div class="travel-log-content" id="travelLogContent"></div>
    </div>
  </main>

  <!-- Toast -->
  <div id="toast" class="toast" style="display:none;"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <!-- App Scripts -->
  <script src="js/config.js"></script>
  <script src="js/storage.js"></script>
  <script src="js/routing.js"></script>
  <script src="js/api.js"></script>
  <script src="js/map.js"></script>
  <script src="js/worldmap.js"></script>
  <script src="js/account.js"></script>
  <script src="js/plan.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/concierge-drawer.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
